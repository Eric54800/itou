{% load i18n %}
{% load static %}
{% load call_method %}
{% comment %}

    Usage:
        {% include "approvals/includes/status.html" with approval=approval %}

{% endcomment %}

{% if approval.is_pass_iae %}
    <p class="text-center">
        {% if approval.is_pass_iae and approval.is_suspended %}
            <img src="{% static 'img/pass_iae/logo_pass_iae_suspended.svg' %}" alt="Logo PASS IAE">
            <br>
            <span class="badge badge-warning">{% translate "PASS IAE suspendu" %}</span>
        {% else %}
            <img src="{% static 'img/pass_iae/logo_pass_iae.svg' %}" alt="Logo PASS IAE">
        {% endif %}
    </p>
{% endif %}

<p>
    {% if approval.is_pass_iae %}
        {% translate "Numéro de PASS IAE (agrément) :" %}
    {% else %}
        {% translate "Agrément existant :" %}
    {% endif %}
    <b>{{ approval.number_with_spaces }}</b>
</p>

{% if approval.is_valid %}

    <ul class="list-unstyled pl-2 border-left" style="border-left-width: 3px !important;">

        {# Delivery date. #}
        <li>
            {% blocktranslate with start=approval.start_at|date:"d/m/Y" %}
                Délivré le {{ start }}
            {% endblocktranslate %}
        </li>

        {# Validity. #}
        <li{% if not approval.is_suspended %} class="text-success"{% endif %}>
            {% blocktranslate with start=approval.start_at|date:"d/m/Y" end=approval.end_at|date:"d/m/Y" %}
                Valide du {{ start }} au {{ end }}
            {% endblocktranslate %}
        </li>

        {# Suspensions history. #}
        {% with approval.suspensions_by_start_date_asc as suspensions %}
            {% if suspensions %}{% translate "Suspendu :" %}{% endif %}
            <ul>
                {% for s in suspensions %}
                    <li{% if s.is_in_progress %} class="font-weight-bold"{% endif %}>
                        {% blocktranslate with start=s.start_at|date:"d/m/Y" end=s.end_at|date:"d/m/Y" %}
                            du {{ start }} au {{ end }}
                        {% endblocktranslate %}
                        <small>({{ s.get_reason_display }})</small>
                        {% if current_siae %}
                            {% call_method s "can_be_updated_by_siae" current_siae as can_be_updated %}
                            {% if can_be_updated %}
                                <a href="{% url 'approvals:suspension_update' suspension_id=s.pk %}?back_url={{ request.get_full_path|urlencode }}">
                                    <small>{% translate "Modifier" %}</small>
                                </a>
                            {% endif %}
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endwith %}

    </ul>

{% elif approval.is_in_waiting_period %}

    <p class="text-danger">
        {% blocktranslate with end=approval.end_at|date:"d/m/Y" since=approval.end_at|timesince %}
            <b>Expiré</b> le {{ end }} (depuis {{ since }})
        {% endblocktranslate %}
    </p>

{% endif %}
